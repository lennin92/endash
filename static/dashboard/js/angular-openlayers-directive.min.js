!function(e,r){"function"==typeof define&&define.amd?define(["ol"],function(t){return e.angularOpenlayersDirective=r(t)}):e.angularOpenlayersDirective=r(e.ol)}(this,function(e){angular.module("openlayers-directive",["ngSanitize"]).directive("openlayers",["$log","$q","$compile","olHelpers","olMapDefaults","olData",function(r,t,o,n,a,i){return{restrict:"EA",transclude:!0,replace:!0,scope:{center:"=olCenter",defaults:"=olDefaults",view:"=olView",events:"=olEvents"},template:'<div class="angular-openlayers-map" ng-transclude></div>',controller:["$scope",function(e){var r=t.defer();e.getMap=function(){return r.promise},e.setMap=function(e){r.resolve(e)},this.getOpenlayersScope=function(){return e}}],link:function(r,t,o){var l=n.isDefined,s=n.createLayer,c=n.setMapEvents,u=n.setViewEvents,p=n.createView,d=a.setDefaults(r);l(o.width)&&(isNaN(o.width)?t.css("width",o.width):t.css("width",o.width+"px")),l(o.height)&&(isNaN(o.height)?t.css("height",o.height):t.css("height",o.height+"px")),l(o.lat)&&(d.center.lat=parseFloat(o.lat)),l(o.lon)&&(d.center.lon=parseFloat(o.lon)),l(o.zoom)&&(d.center.zoom=parseFloat(o.zoom));var g=e.control.defaults(d.controls),f=e.interaction.defaults(d.interactions),m=p(d.view),v=new e.Map({target:t[0],controls:g,interactions:f,renderer:d.renderer,view:m});if(!o.customLayers){var y={type:"Tile",source:{type:"OSM"}},w=s(y,m.getProjection(),"default");v.addLayer(w),v.set("default",!0)}if(!l(o.olCenter)){var h=e.proj.transform([d.center.lon,d.center.lat],d.center.projection,m.getProjection());m.setCenter(h),m.setZoom(d.center.zoom)}c(d.events,v,r),u(d.events,v,r),r.setMap(v),i.setMap(v,o.id)}}}]),angular.module("openlayers-directive").directive("olCenter",["$log","$location","olMapDefaults","olHelpers",function(r,t,o,n){return{restrict:"A",scope:!1,replace:!1,require:"openlayers",link:function(a,i,l,s){var c=n.safeApply,u=n.isValidCenter,p=n.isDefined,d=n.isArray,g=n.isNumber,f=n.isSameCenterOnMap,m=n.setCenter,v=n.setZoom,y=s.getOpenlayersScope();y.getMap().then(function(a){var i=o.getDefaults(y),s=a.getView(),w=y.center;if(-1!==l.olCenter.search("-"))return r.error('[AngularJS - Openlayers] The "center" variable can\'t use a "-" on his key name: "'+l.center+'".'),void m(s,i.view.projection,i.center,a);p(w)||(w={}),u(w)||(r.warn("[AngularJS - Openlayers] invalid 'center'"),w.lat=i.center.lat,w.lon=i.center.lon,w.zoom=i.center.zoom,w.projection=i.center.projection),w.projection||("pixel"!==i.view.projection?w.projection=i.center.projection:w.projection="pixel"),g(w.zoom)||(w.zoom=1),m(s,i.view.projection,w,a),s.setZoom(w.zoom);var h;if(w.centerUrlHash===!0){var S=function(){var e,r=t.search();if(p(r.c)){var o=r.c.split(":");3===o.length&&(e={lat:parseFloat(o[0]),lon:parseFloat(o[1]),zoom:parseInt(o[2],10)})}return e};h=S(),y.$on("$locationChangeSuccess",function(){var e=S();e&&!f(e,a)&&c(y,function(r){r.center.lat=e.lat,r.center.lon=e.lon,r.center.zoom=e.zoom})})}var b;y.$watchCollection("center",function(t){if(t){if(t.projection||(t.projection=i.center.projection),t.autodiscover)return b||(b=new e.Geolocation({projection:e.proj.get(t.projection)}),b.on("change",function(){if(t.autodiscover){var e=b.getPosition();c(y,function(r){r.center.lat=e[1],r.center.lon=e[0],r.center.zoom=12,r.center.autodiscover=!1,b.setTracking(!1)})}})),void b.setTracking(!0);u(t)||(r.warn("[AngularJS - Openlayers] invalid 'center'"),t=i.center);var o=s.getCenter();if(o){if("pixel"===i.view.projection)return void s.setCenter(t.coord);var n=e.proj.transform(o,i.view.projection,t.projection);(n[1]!==t.lat||n[0]!==t.lon)&&m(s,i.view.projection,t,a)}s.getZoom()!==t.zoom&&v(s,t.zoom,a)}}),a.on("moveend",function(){c(y,function(r){if(p(r.center)){var o=a.getView().getCenter();if(r.center.zoom=s.getZoom(),"pixel"===i.view.projection)return void(r.center.coord=o);if(r.center){var l=e.proj.transform(o,i.view.projection,r.center.projection);if(r.center.lat=l[1],r.center.lon=l[0],n.notifyCenterUrlHashChanged(y,r.center,t.search()),d(r.center.bounds)){var c=s.calculateExtent(a.getSize()),u=r.center.projection,g=i.view.projection;r.center.bounds=e.proj.transformExtent(c,g,u)}}}})})})}}}]),angular.module("openlayers-directive").directive("olLayer",["$log","$q","olMapDefaults","olHelpers",function(e,r,t,o){return{restrict:"E",scope:{properties:"=olLayerProperties"},replace:!1,require:"^openlayers",link:function(e,r,n,a){var i=o.isDefined,l=o.equals,s=a.getOpenlayersScope(),c=o.createLayer,u=o.setVectorLayerEvents,p=o.detectLayerType,d=o.createStyle,g=o.isBoolean,f=o.addLayerBeforeMarkers,m=o.isNumber,v=o.insertLayer,y=o.removeLayer;s.getMap().then(function(r){var o,a=r.getView().getProjection(),w=t.setDefaults(s),h=r.getLayers();if(e.$on("$destroy",function(){y(h,o.index),r.removeLayer(o)}),i(e.properties))e.$watch("properties",function(t,n){if(i(t.source)&&i(t.source.type)){if(!i(t.visible))return void(t.visible=!0);if(!i(t.opacity))return void(t.opacity=1);var s;if(i(o)){var S=function(e){return function(r){return r!==e}}(o);if(i(n)&&!l(t.source,n.source)){var b=o.index;h.removeAt(b),o=c(t,a),i(o)&&(v(h,b,o),"Vector"===p(t)&&u(w.events,r,e,t.name))}(i(n)&&t.opacity!==n.opacity||S(o))&&(m(t.opacity)||m(parseFloat(t.opacity)))&&o.setOpacity(t.opacity),i(t.index)&&t.index!==o.index&&(y(h,o.index),v(h,t.index,o)),(i(n)&&g(t.visible)&&t.visible!==n.visible||S(o))&&o.setVisible(t.visible),(i(t.style)&&!l(t.style,n.style)||S(o))&&(s=angular.isFunction(t.style)?t.style:d(t.style),o.setStyle&&angular.isFunction(o.setStyle)&&o.setStyle(s))}else o=c(t,a),i(t.index)?v(h,t.index,o):f(h,o),"Vector"===p(t)&&u(w.events,r,e,t.name),g(t.visible)&&o.setVisible(t.visible),t.opacity&&o.setOpacity(t.opacity),angular.isArray(t.extent)&&o.setExtent(t.extent),t.style&&(s=angular.isFunction(t.style)?t.style:d(t.style),o.setStyle&&angular.isFunction(o.setStyle)&&o.setStyle(s))}},!0);else if(i(n.sourceType)&&i(n.sourceUrl)){var S={source:{url:n.sourceUrl,type:n.sourceType}};o=c(S,a,n.layerName),"Vector"===p(S)&&u(w.events,r,e,n.name),f(h,o)}})}}}]),angular.module("openlayers-directive").directive("olPath",["$log","$q","olMapDefaults","olHelpers",function(e,r,t,o){return{restrict:"E",scope:{properties:"=olGeomProperties"},require:"^openlayers",replace:!0,template:'<div class="popup-label path" ng-bind-html="message"></div>',link:function(e,r,n,a){var i=o.isDefined,l=o.createFeature,s=o.createOverlay,c=o.createVectorLayer,u=o.insertLayer,p=o.removeLayer,d=a.getOpenlayersScope();d.getMap().then(function(o){var a=t.getDefaults(d),g=a.view.projection,f=c(),m=o.getLayers();if(u(m,m.getLength(),f),e.$on("$destroy",function(){p(m,f.index)}),i(n.coords)){var v=n.proj||"EPSG:4326",y=JSON.parse(n.coords),w={type:"Polygon",coords:y,projection:v,style:a.styles.path},h=l(w,g);if(f.getSource().addFeature(h),n.message){e.message=n.message;var S=h.getGeometry().getExtent(),b=s(r,S);o.addOverlay(b)}}else;})}}}]),angular.module("openlayers-directive").directive("olView",["$log","$q","olData","olMapDefaults","olHelpers",function(e,r,t,o,n){return{restrict:"A",scope:!1,replace:!1,require:"openlayers",link:function(e,r,t,a){var i=a.getOpenlayersScope(),l=n.isNumber,s=n.safeApply,c=n.createView;i.getMap().then(function(e){var r=o.getDefaults(i),t=i.view;t.projection||(t.projection=r.view.projection),t.maxZoom||(t.maxZoom=r.view.maxZoom),t.minZoom||(t.minZoom=r.view.minZoom),t.rotation||(t.rotation=r.view.rotation);var n=c(t);e.setView(n),i.$watchCollection("view",function(e){l(e.rotation)&&n.setRotation(e.rotation)}),n.on("change:rotation",function(){s(i,function(r){r.view.rotation=e.getView().getRotation()})})})}}}]),angular.module("openlayers-directive").directive("olControl",["$log","$q","olData","olMapDefaults","olHelpers",function(e,r,t,o,n){return{restrict:"E",scope:{properties:"=olControlProperties"},replace:!1,require:"^openlayers",link:function(e,r,t,o){var a,i,l=n.isDefined,s=o.getOpenlayersScope();s.getMap().then(function(r){var o=n.getControlClasses,s=o();return e.$on("$destroy",function(){r.removeControl(a)}),l(e.properties)&&l(e.properties.control)?(a=e.properties.control,void r.addControl(a)):void(t.name&&(l(e.properties)&&(i=e.properties),a=new s[t.name](i),r.addControl(a)))})}}}]),angular.module("openlayers-directive").directive("olMarker",["$log","$q","olMapDefaults","olHelpers",function(r,t,o,n){var a=function(){return{projection:"EPSG:4326",lat:0,lon:0,coord:[],show:!0,showOnMouseOver:!1,showOnMouseClick:!1,keepOneOverlayVisible:!1}},i=function(){function e(e){return r.map(function(e){return e.map}).indexOf(e)}var r=[];return{getInst:function(t,o){var a=e(o);if(-1===a){var i=n.createVectorLayer();i.set("markers",!0),o.addLayer(i),r.push({map:o,markerLayer:i,instScopes:[]}),a=r.length-1}return r[a].instScopes.push(t),r[a].markerLayer},deregisterScope:function(t,o){var n=e(o);if(-1===n)throw Error("This map has no markers");var a=r[n].instScopes,i=a.indexOf(t);if(-1===i)throw Error("Scope wan't registered");a.splice(i,1),a.length||(o.removeLayer(r[n].markerLayer),delete r[n])}}}();return{restrict:"E",scope:{lat:"=lat",lon:"=lon",label:"=label",properties:"=olMarkerProperties",style:"=olStyle"},transclude:!0,require:"^openlayers",replace:!0,template:'<div class="popup-label marker"><div ng-bind-html="message"></div><ng-transclude></ng-transclude></div>',link:function(t,l,s,c){var u=n.isDefined,p=c.getOpenlayersScope(),d=n.createFeature,g=n.createOverlay,f=l.find("ng-transclude").children().length>0;p.getMap().then(function(n){var c,m,v,y=i.getInst(t,n),w=a(),h=o.getDefaults(p),S=h.view.projection;return t.$on("$destroy",function(){y.getSource().removeFeature(v),u(c)&&n.removeOverlay(c),i.deregisterScope(t,n)}),u(t.properties)?void t.$watch("properties",function(o){function a(r){if(!o.label.show){var a=!1,i=n.getEventPixel(r),s=n.forEachFeatureAtPixel(i,function(e){return e}),p=!1;s===v&&(p=!0,a=!0,u(c)||(m="pixel"===w.projection?w.coord:e.proj.transform([w.lon,w.lat],w.projection,S),c=g(l,m),n.addOverlay(c)),!o.onClick||"click"!==r.type&&"touchend"!==r.type||t.$apply(function(){o.onClick.call(v,r,o)}),n.getTarget().style.cursor="pointer"),!a&&c&&(p=!0,n.removeOverlay(c),c=void 0,n.getTarget().style.cursor=""),p&&r.preventDefault()}}function i(r){if(!o.label.show){var t=!1,a=n.getEventPixel(r),i=n.forEachFeatureAtPixel(a,function(e){return e}),s=!1;i===v&&(s=!0,t=!0,u(c)||(m="pixel"===w.projection?w.coord:e.proj.transform([w.lon,w.lat],w.projection,S),c=g(l,m),angular.forEach(n.getOverlays(),function(e){n.removeOverlay(e)}),n.addOverlay(c)),n.getTarget().style.cursor="pointer"),!t&&c&&(s=!0,c=void 0,n.getTarget().style.cursor=""),s&&r.preventDefault()}}function s(e){angular.forEach(n.getOverlays(),function(e){n.removeOverlay(e)}),e.preventDefault()}var p=function(){function e(){t=!0,r&&clearTimeout(r),r=setTimeout(function(){t=!1,r=null},500)}var r,t=!1;return n.getViewport().querySelector("canvas.ol-unselectable").addEventListener("touchmove",e),function(){t||(a.apply(null,arguments),e())}}();if(u(v)){var b=e.proj.transform([o.lon,o.lat],w.projection,n.getView().getProjection());if(!angular.equals(v.getGeometry().getCoordinates(),b)){var O=new e.geom.Point(b);v.setGeometry(O)}}else w.projection=o.projection?o.projection:w.projection,w.coord=o.coord?o.coord:w.coord,w.lat=o.lat?o.lat:w.lat,w.lon=o.lon?o.lon:w.lon,u(o.style)?w.style=o.style:w.style=h.styles.marker,v=d(w,S),u(v)||r.error("[AngularJS - Openlayers] Received invalid data on the marker."),y.getSource().addFeature(v);u(c)&&n.removeOverlay(c),u(o.label)&&(t.message=o.label.message,(f||u(t.message)&&0!==t.message.length)&&(o.label&&o.label.show===!0&&(m="pixel"===w.projection?w.coord:e.proj.transform([o.lon,o.lat],w.projection,S),c=g(l,m),n.addOverlay(c)),c&&o.label&&o.label.show===!1&&(n.removeOverlay(c),c=void 0),o.label&&o.label.show===!1&&o.label.showOnMouseOver&&n.getViewport().addEventListener("mousemove",a),(o.label&&o.label.show===!1&&o.label.showOnMouseClick||o.onClick)&&(n.getViewport().addEventListener("click",p),n.getViewport().querySelector("canvas.ol-unselectable").addEventListener("touchend",p)),o.label&&o.label.show===!1&&o.label.keepOneOverlayVisible&&(n.getViewport().addEventListener("mousemove",i),n.getViewport().addEventListener("click",s))))},!0):(w.lat=t.lat?t.lat:w.lat,w.lon=t.lon?t.lon:w.lon,w.message=s.message,w.style=t.style?t.style:h.styles.marker,v=d(w,S),u(v)||r.error("[AngularJS - Openlayers] Received invalid data on the marker."),y.getSource().addFeature(v),void((w.message||f)&&(t.message=s.message,m=e.proj.transform([w.lon,w.lat],w.projection,S),c=g(l,m),n.addOverlay(c))))})}}}]),angular.module("openlayers-directive").service("olData",["$log","$q","olHelpers",function(e,r,t){var o=t.obtainEffectiveMapId,n={},a=function(e,r){var t=o(e,r);e[t].resolvedDefer=!0},i=function(e,t){var n,a=o(e,t);return angular.isDefined(e[a])&&e[a].resolvedDefer!==!0?n=e[a].defer:(n=r.defer(),e[a]={defer:n,resolvedDefer:!1}),n},l=function(e,r){var t,n=o(e,r);return t=angular.isDefined(e[n])&&e[n].resolvedDefer!==!1?e[n].defer:i(e,r)};this.setMap=function(e,r){var t=i(n,r);t.resolve(e),a(n,r)},this.getMap=function(e){var r=l(n,e);return r.promise}}]),angular.module("openlayers-directive").factory("olHelpers",["$q","$log","$http",function(r,t,o){var n=function(e){return angular.isDefined(e)},a=function(e,r,t){e.on(r,function(o){var n=o.coordinate,a=e.getView().getProjection().getCode();"pixel"===a&&(n=n.map(function(e){return parseInt(e,10)})),t.$emit("openlayers.map."+r,{coord:n,projection:a,event:o})})},i=["Road","Aerial","AerialWithLabels","collinsBart","ordnanceSurvey"],l=function(){return{attribution:e.control.Attribution,fullscreen:e.control.FullScreen,mouseposition:e.control.MousePosition,rotate:e.control.Rotate,scaleline:e.control.ScaleLine,zoom:e.control.Zoom,zoomslider:e.control.ZoomSlider,zoomtoextent:e.control.ZoomToExtent}},s=["osm","sat","hyb"],c=["World_Imagery","World_Street_Map","World_Topo_Map","World_Physical_Map","World_Terrain_Base","Ocean_Basemap","NatGeo_World_Map"],u={style:e.style.Style,fill:e.style.Fill,stroke:e.style.Stroke,circle:e.style.Circle,icon:e.style.Icon,image:e.style.Image,regularshape:e.style.RegularShape,text:e.style.Text},p=function(e,r){return r&&e instanceof r?e:r?new r(e):e},d=function w(e,r){var t;if(r?t=e[r]:(r="style",t=e),"style"===r&&e instanceof Function)return e;if(!(t instanceof Object))return t;var o;if("[object Object]"===Object.prototype.toString.call(t)){o={};var n=u[r];if(n&&t instanceof n)return t;Object.getOwnPropertyNames(t).forEach(function(e,a,i){var l=u[e];return n&&l&&l.prototype instanceof u[r]?(console.assert(1===i.length,"Extra parameters for "+r),o=w(t,e),p(o,l)):(o[e]=w(t,e),void("text"!==e&&"string"!=typeof o[e]&&(o[e]=p(o[e],u[e]))))})}else o=t;return p(o,u[r])},g=function(e){if(e.type)return e.type;switch(e.source.type){case"ImageWMS":return"Image";case"ImageStatic":return"Image";case"GeoJSON":return"Vector";case"JSONP":return"Vector";case"TopoJSON":return"Vector";case"KML":return"Vector";case"TileVector":return"Vector";default:return"Tile"}},f=function(r){var o;switch(r.projection){case"pixel":if(!n(r.extent))return void t.error("[AngularJS - Openlayers] - You must provide the extent of the image if using pixel projection");o=new e.proj.Projection({code:"pixel",units:"pixels",extent:r.extent});break;default:o=new e.proj.get(r.projection)}return o},m=function(e){return-1!==["watercolor","terrain","toner"].indexOf(e)},v=function(r,a){var l;switch(r.type){case"MapBox":if(!r.mapId||!r.accessToken)return void t.error("[AngularJS - Openlayers] - MapBox layer requires the map id and the access token");var u="http://api.tiles.mapbox.com/v4/"+r.mapId+"/{z}/{x}/{y}.png?access_token="+r.accessToken,p=window.devicePixelRatio;p>1&&(u=u.replace(".png","@2x.png")),l=new e.source.XYZ({url:u,attributions:y(r),tilePixelRatio:p>1?2:1});break;case"ImageWMS":r.url&&r.params||t.error("[AngularJS - Openlayers] - ImageWMS Layer needs valid server url and params properties"),l=new e.source.ImageWMS({url:r.url,attributions:y(r),crossOrigin:"undefined"==typeof r.crossOrigin?"anonymous":r.crossOrigin,params:r.params});break;case"TileWMS":(r.url||r.urls)&&r.params||t.error("[AngularJS - Openlayers] - TileWMS Layer needs valid url (or urls) and params properties");var d={crossOrigin:"undefined"==typeof r.crossOrigin?"anonymous":r.crossOrigin,params:r.params,attributions:y(r)};r.url&&(d.url=r.url),r.urls&&(d.urls=r.urls),l=new e.source.TileWMS(d);break;case"WMTS":(r.url||r.urls)&&r.tileGrid||t.error("[AngularJS - Openlayers] - WMTS Layer needs valid url (or urls) and tileGrid properties");var g={projection:a,layer:r.layer,attributions:y(r),matrixSet:"undefined"===r.matrixSet?a:r.matrixSet,format:"undefined"===r.format?"image/jpeg":r.format,requestEncoding:"undefined"===r.requestEncoding?"KVP":r.requestEncoding,tileGrid:new e.tilegrid.WMTS({origin:r.tileGrid.origin,resolutions:r.tileGrid.resolutions,matrixIds:r.tileGrid.matrixIds})};n(r.url)&&(g.url=r.url),n(r.urls)&&(g.urls=r.urls),l=new e.source.WMTS(g);break;case"OSM":l=new e.source.OSM({attributions:y(r)}),r.url&&l.setUrl(r.url);break;case"BingMaps":if(!r.key)return void t.error("[AngularJS - Openlayers] - You need an API key to show the Bing Maps.");var f={key:r.key,attributions:y(r),imagerySet:r.imagerySet?r.imagerySet:i[0]};r.maxZoom&&(f.maxZoom=r.maxZoom),l=new e.source.BingMaps(f);break;case"MapQuest":if(!r.layer||-1===s.indexOf(r.layer))return void t.error("[AngularJS - Openlayers] - MapQuest layers needs a valid 'layer' property.");l=new e.source.MapQuest({attributions:y(r),layer:r.layer});break;case"EsriBaseMaps":if(!r.layer||-1===c.indexOf(r.layer))return void t.error("[AngularJS - Openlayers] - ESRI layers needs a valid 'layer' property.");var v="http://services.arcgisonline.com/ArcGIS/rest/services/",w=v+r.layer+"/MapServer/tile/{z}/{y}/{x}";l=new e.source.XYZ({attributions:y(r),url:w});break;case"GeoJSON":if(!r.geojson&&!r.url)return void t.error("[AngularJS - Openlayers] - You need a geojson property to add a GeoJSON layer.");n(r.url)?l=new e.source.GeoJSON({projection:a,url:r.url}):(n(r.geojson.projection)||(r.geojson.projection=a),l=new e.source.GeoJSON(r.geojson));break;case"JSONP":if(!r.url)return void t.error("[AngularJS - Openlayers] - You need an url properly configured to add a JSONP layer.");n(r.url)&&(l=new e.source.ServerVector({format:new e.format.GeoJSON,loader:function(){var e=r.url+"&outputFormat=text/javascript&format_options=callback:JSON_CALLBACK";o.jsonp(e,{cache:r.cache}).success(function(e){l.addFeatures(l.readFeatures(e))}).error(function(e){t(e)})},projection:a}));break;case"TopoJSON":if(!r.topojson&&!r.url)return void t.error("[AngularJS - Openlayers] - You need a topojson property to add a TopoJSON layer.");l=r.url?new e.source.TopoJSON({projection:a,url:r.url}):new e.source.TopoJSON(r.topojson);break;case"TileJSON":l=new e.source.TileJSON({url:r.url,attributions:y(r),crossOrigin:"anonymous"});break;case"TileVector":r.url&&r.format||t.error("[AngularJS - Openlayers] - TileVector Layer needs valid url and format properties"),l=new e.source.TileVector({url:r.url,projection:a,attributions:y(r),format:r.format,tileGrid:new e.tilegrid.XYZ({maxZoom:r.maxZoom||19})});break;case"TileTMS":r.url&&r.tileGrid||t.error("[AngularJS - Openlayers] - TileTMS Layer needs valid url and tileGrid properties"),l=new e.source.TileImage({url:r.url,maxExtent:r.maxExtent,attributions:y(r),tileGrid:new e.tilegrid.TileGrid({origin:r.tileGrid.origin,resolutions:r.tileGrid.resolutions}),tileUrlFunction:function(e){var t=e[0],o=e[1],n=e[2];if(0>o||0>n)return"";var a=r.url+t+"/"+o+"/"+n+".png";return a}});break;case"TileImage":l=new e.source.TileImage({url:r.url,attributions:y(r),tileGrid:new e.tilegrid.TileGrid({origin:r.tileGrid.origin,resolutions:r.tileGrid.resolutions}),tileUrlFunction:function(e){var t=e[0],o=e[1],n=-e[2]-1,a=r.url.replace("{z}",t.toString()).replace("{x}",o.toString()).replace("{y}",n.toString());return a}});break;case"KML":var h=r.extractStyles||!1;l=new e.source.KML({url:r.url,projection:r.projection,radius:r.radius,extractStyles:h});break;case"Stamen":if(!r.layer||!m(r.layer))return void t.error("[AngularJS - Openlayers] - You need a valid Stamen layer.");l=new e.source.Stamen({layer:r.layer});break;case"ImageStatic":if(!r.url||!angular.isArray(r.imageSize)||2!==r.imageSize.length)return void t.error("[AngularJS - Openlayers] - You need a image URL to create a ImageStatic layer.");l=new e.source.ImageStatic({url:r.url,attributions:y(r),imageSize:r.imageSize,projection:a,imageExtent:a.getExtent(),imageLoadFunction:r.imageLoadFunction});break;case"XYZ":r.url||t.error("[AngularJS - Openlayers] - XYZ Layer needs valid url and params properties"),l=new e.source.XYZ({url:r.url,attributions:y(r),minZoom:r.minZoom,maxZoom:r.maxZoom})}return l||t.warn('[AngularJS - Openlayers] - No source could be found for type "'+r.type+'"'),l},y=function(r){var t=[];return n(r.attribution)&&t.unshift(new e.Attribution({html:r.attribution})),t};return{isDefined:n,isNumber:function(e){return angular.isNumber(e)},createView:function(r){var t=f(r);return new e.View({projection:t,maxZoom:r.maxZoom,minZoom:r.minZoom,extent:r.extent})},isDefinedAndNotNull:function(e){return angular.isDefined(e)&&null!==e},isString:function(e){return angular.isString(e)},isArray:function(e){return angular.isArray(e)},isObject:function(e){return angular.isObject(e)},equals:function(e,r){return angular.equals(e,r)},isValidCenter:function(e){return angular.isDefined(e)&&("boolean"==typeof e.autodiscover||angular.isNumber(e.lat)&&angular.isNumber(e.lon)||angular.isArray(e.coord)&&2===e.coord.length&&angular.isNumber(e.coord[0])&&angular.isNumber(e.coord[1])||angular.isArray(e.bounds)&&4===e.bounds.length&&angular.isNumber(e.bounds[0])&&angular.isNumber(e.bounds[1])&&angular.isNumber(e.bounds[1])&&angular.isNumber(e.bounds[2]))},safeApply:function(e,r){var t=e.$root.$$phase;"$apply"===t||"$digest"===t?e.$eval(r):e.$apply(r)},isSameCenterOnMap:function(r,t){var o=r.projection||"EPSG:4326",n=[r.lon,r.lat],a=t.getView().getProjection(),i=e.proj.transform(t.getView().getCenter(),a,o),l=t.getView().getZoom();return i[1].toFixed(4)===n[1].toFixed(4)&&i[0].toFixed(4)===n[0].toFixed(4)&&l===r.zoom?!0:!1},setCenter:function(r,t,o,n){if(n&&r.getCenter()){var a=e.animation.pan({duration:150,source:r.getCenter()});n.beforeRender(a)}if(o.projection===t)r.setCenter([o.lon,o.lat]);else{var i=[o.lon,o.lat];r.setCenter(e.proj.transform(i,o.projection,t))}},setZoom:function(r,t,o){var n=e.animation.zoom({duration:150,resolution:o.getView().getResolution()});o.beforeRender(n),r.setZoom(t)},isBoolean:function(e){return"boolean"==typeof e},obtainEffectiveMapId:function(e,r){var o,n;if(angular.isDefined(r))o=r;else if(1===Object.keys(e).length)for(n in e)e.hasOwnProperty(n)&&(o=n);else 0===Object.keys(e).length?o="main":t.error("[AngularJS - Openlayers] - You have more than 1 map on the DOM, you must provide the map ID to the olData.getXXX call");return o},createStyle:d,setMapEvents:function(e,r,t){if(n(e)&&angular.isArray(e.map))for(var o in e.map){var i=e.map[o];a(r,i,t)}},setVectorLayerEvents:function(e,r,t,o){n(e)&&angular.isArray(e.layers)&&angular.forEach(e.layers,function(e){angular.element(r.getViewport()).on(e,function(a){var i=r.getEventPixel(a),l=r.forEachFeatureAtPixel(i,function(e,r){return r.get("name")===o?e:null});n(l)&&t.$emit("openlayers.layers."+o+"."+e,l,a)})})},setViewEvents:function(e,r,t){if(n(e)&&angular.isArray(e.view)){var o=r.getView();angular.forEach(e.view,function(e){o.on(e,function(r){t.$emit("openlayers.view."+e,o,r)})})}},detectLayerType:g,createLayer:function(r,t,o){var a,i=g(r),l=v(r.source,t);if(l){switch("Vector"===i&&r.clustering&&(l=new e.source.Cluster({source:l,distance:r.clusteringDistance})),i){case"Image":a=new e.layer.Image({source:l});break;case"Tile":a=new e.layer.Tile({source:l});break;case"Heatmap":a=new e.layer.Heatmap({source:l});break;case"Vector":a=new e.layer.Vector({source:l})}return n(o)?a.set("name",o):n(r.name)&&a.set("name",r.name),a}},createVectorLayer:function(){return new e.layer.Vector({source:new e.source.Vector})},notifyCenterUrlHashChanged:function(e,r,t){if(r.centerUrlHash){var o=r.lat.toFixed(4)+":"+r.lon.toFixed(4)+":"+r.zoom;n(t.c)&&t.c===o||e.$emit("centerUrlHash",o)}},getControlClasses:l,detectControls:function(e){var r={},t=l();return e.forEach(function(e){for(var o in t)e instanceof t[o]&&(r[o]=e)}),r},createFeature:function(r,t){var o;switch(r.type){case"Polygon":o=new e.geom.Polygon(r.coords);break;default:o=n(r.coord)&&"pixel"===r.projection?new e.geom.Point(r.coord):new e.geom.Point([r.lon,r.lat])}n(r.projection)&&"pixel"!==r.projection&&(o=o.transform(r.projection,t));var a=new e.Feature({geometry:o});if(n(r.style)){var i=d(r.style);a.setStyle(i)}return a},addLayerBeforeMarkers:function(e,r){for(var t,o=0;o<e.getLength();o++){var a=e.item(o);if(a.get("markers")){t=o;break}}if(n(t)){var i=e.item(t);r.index=t,e.setAt(t,r),i.index=e.getLength(),e.push(i)}else r.index=e.getLength(),e.push(r)},removeLayer:function(e,r){e.removeAt(r);for(var t=r;t<e.getLength();t++){var o=e.item(t);if(null===o){e.insertAt(t,null);break}o.index=t}},insertLayer:function(e,r,t){if(e.getLength()<r){for(;e.getLength()<r;)e.push(null);t.index=r,e.push(t)}else{t.index=r,e.insertAt(t.index,t);for(var o=r+1;o<e.getLength();o++){var n=e.item(o);if(null===n){e.removeAt(o);break}n.index=o}}},createOverlay:function(r,t){r.css("display","block");var o=new e.Overlay({position:t,element:r,positioning:"center-left"});return o}}}]),angular.module("openlayers-directive").factory("olMapDefaults",["$q","olHelpers",function(r,t){var o="data:image/png;base64,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",n=function(){return{view:{projection:"EPSG:3857",minZoom:void 0,maxZoom:void 0,rotation:0,extent:void 0},center:{lat:0,lon:0,zoom:1,autodiscover:!1,bounds:[],centerUrlHash:!1,projection:"EPSG:4326"},styles:{path:{stroke:{color:"blue",width:8}},marker:{image:new e.style.Icon({anchor:[.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction",opacity:.9,src:o})}},events:{map:[],markers:[],layers:[]},controls:{attribution:!0,rotate:!1,zoom:!0},interactions:{mouseWheelZoom:!1},renderer:"canvas"}},a=t.isDefined,i={};return{getDefaults:function(e){if(!a(e))for(var r in i)return i[r];return i[e.$id]},setDefaults:function(e){var r=e.defaults,t=e.$id,o=n();return a(r)&&(a(r.layers)&&(o.layers=angular.copy(r.layers)),a(r.controls)&&(o.controls=angular.copy(r.controls)),a(r.events)&&(o.events=angular.copy(r.events)),a(r.interactions)&&(o.interactions=angular.copy(r.interactions)),a(r.renderer)&&(o.renderer=r.renderer),a(r.view)&&(o.view.maxZoom=r.view.maxZoom||o.view.maxZoom,o.view.minZoom=r.view.minZoom||o.view.minZoom,o.view.projection=r.view.projection||o.view.projection,o.view.extent=r.view.extent||o.view.extent),a(r.styles)&&(o.styles=angular.extend(o.styles,r.styles))),i[t]=o,o}}}])});